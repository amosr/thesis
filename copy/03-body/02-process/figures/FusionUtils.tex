%!TEX root = ../Main.tex
\begin{figure}

\begin{tabbing}
$\ChanType_2$   \TABDEF \kill

\ti{channels} \> $:$ \> $\Proc \to \Proc \to \MapType{\Chan}{\ChanType_2}$ \\

  \> $=$    \> $\{ c=@MMMMMMM@~$\= \kill
$\ti{channels}~p~q$
  \> $=$    \> $\{ c=@in2@$
            \> $|~c~\in~(\lstiproc@ins@~p~\cap~\lstiproc@ins@~q) \}$ 
            \\

  \> $\cup$ \> $\{ c=@in1@$
            \> $ |~c~\in~(\lstiproc@ins@~p~\cup~\lstiproc@ins@~q)~\wedge~c~\not\in(\lstiproc@outs@~p~\cup~\lstiproc@outs@~q) \}$ \\

  \> $\cup$ \> $\{ c=@in1out1@$
            \> $|~c~\in~(\lstiproc@ins@~p~\cup~\lstiproc@ins@~q)~\wedge~c~\in(\lstiproc@outs@~p~\cup~\lstiproc@outs@~q) \}$ \\

  \> $\cup$ \> $\{ c=@out1@$
            \> $ |~c~\not\in~(\lstiproc@ins@~p~\cup~\lstiproc@ins@~q)~\wedge~c~\in(\lstiproc@outs@~p~\cup~\lstiproc@outs@~q) \}$ 
\end{tabbing}

\newcommand\funClauseDef[3]
{ $\ti{#1}~(#2)$ \> $=$ \> $#3$
}
\newcommand\outlabelsDef[2]
{ \funClauseDef{outlabels}{#1}{\sgl{#2}} 
}

\vspace{1ex}
\begin{tabbing}
$\ti{outlabels}~(\lstiproc@case@~e~(l_t,u_t)~(l_t,u_f))$ \TABSKIP $=$ \TABSKIP \kill
\ti{outlabels} \> $~:$ \> $\Instr \to \sgl{\Label}$ \\
\outlabelsDef{\lstiproc@pull@~c~x~(l,u)~(l',u')}{l,l'}              \\
\outlabelsDef{\lstiproc@drop@~c~(l,u)}{l}                \\
\outlabelsDef{\lstiproc@push@~c~e~(l,u)}{l}              \\
\outlabelsDef{\lstiproc@close@~c~(l,u)}{l}              \\
\outlabelsDef{\lstiproc@case@~e~(l,u)~(l',u')}{l, l'}    \\
\outlabelsDef{\lstiproc@jump@~(l,u)}{l}                  \\
\outlabelsDef{\lstiproc@exit@}{}
\end{tabbing}

\vspace{1ex}
\begin{tabbing}
$\ti{swaplabels}~(\lstiproc@pull@~c~x~((l_1,l_2),u)~((l'_1,l'_2),u'))$ \TABSKIP $=$ \TABSKIP \kill
\ti{swaplabels} \> $~:$ \> $\Instr \to \Instr$ \\
\funClauseDef{swaplabels}
  {\lstiproc@pull@~c~x~((l_1,l_2),u)~((l'_1,l'_2),u')}
  {\lstiproc@pull@~c~x~((l_2,l_1),u)~((l'_2,l'_1),u')}    \\
\funClauseDef{swaplabels}
  {\lstiproc@drop@~c~((l_1,l_2),u)}
  {\lstiproc@drop@~c~((l_2,l_1),u)}      \\
\funClauseDef{swaplabels}
  {\lstiproc@push@~c~e~((l_1,l_2),u)}
  {\lstiproc@push@~c~e~((l_2,l_1),u)}    \\
\funClauseDef{swaplabels}
  {\lstiproc@close@~c~((l_1,l_2),u)}
  {\lstiproc@close@~c~((l_2,l_1),u)}    \\
\funClauseDef{swaplabels}
  {\lstiproc@case@~e~((l_1,l_2),u)~((l'_1,l'_2),u')}
  {\lstiproc@case@~e~((l_2,l_1),u)~((l'_2,l'_1),u')}     \\
\funClauseDef{swaplabels}
  {\lstiproc@jump@~((l_1,l_2),u)}
  {\lstiproc@jump@~((l_2,l_1),u)}  \\
\funClauseDef{swaplabels}
  {\lstiproc@exit@}
  {\lstiproc@exit@}
\end{tabbing}

\caption{Utility functions for fusion}
\label{fig:Fusion:Utils}
\end{figure}

